<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>회원가입</title>
</head>

<body>

  <div class="container mt-3 mb-3">
    <div class="row justify-content-center">
      <div class="col-xl-8">
        <h2 class="text-center mt-3 mb-5">회원가입</h2>
        <form id="user-form">

          <label for="username" class="form-label">아이디</label>
          <div class="input-group mb-5">
            <input type="text" th:field="*{name}" id="username" class="form-control">
            <button class="btn btn-outline-secondary" type="button" id="checkUsernameBtn">중복 확인</button>
          </div>
          <div id="usernameCheckResult" class="mt-2"></div>

          <div class="mb-5">
            <label for="password" class="form-label">비밀번호</label>
            <input type="password" th:field="*{password}" id="password" class="form-control">
          </div>

          <div class="mb-5">
            <label for="address" class="form-label">주소</label>
            <input type="address" th:field="*{address}" id="address" class="form-control">
          </div>

          <div class="mb-5">
            <label for="phoneNumber" class="form-label">전화번호</label>
            <input type="text" th:field="*{phoneNumber}" id="phoneNumber" class="form-control">
          </div>

          <button type="submit" class="btn btn-primary">가입</button>
        </form>

      </div>
    </div>

  </div>


  <script>
    const usernameInput = document.getElementById('username');
    const checkUsernameBtn = document.getElementById('checkUsernameBtn');
    const usernameCheckResult = document.getElementById('usernameCheckResult');

    checkUsernameBtn.addEventListener('click', () => {
      const username = usernameInput.value.trim();
      if (username === "" | username === null) {
        usernameCheckResult.textContent = "아이디를 입력해주세요.";
        usernameCheckResult.className = "text-danger mt-2"; // 빨간색
        return;
      }

      if (username === "0" | username === "undefined" | !isNaN(username) | username === "select"
        | username === "delete" | username === "create" | username === "update") {
        usernameCheckResult.textContent = "잘못된 아이디 형식입니다.";
        usernameCheckResult.className = "text-danger mt-2";
        return;
      }

      fetch('/checkId?username=' + username) // 스프링 엔드포인트 호출
        .then(response => response.json())
        .then(data => {
          if (data.exists) {
            usernameCheckResult.textContent = "중복된 아이디입니다.";
            usernameCheckResult.className = "text-danger mt-2"; // 빨간색
          } else {
            usernameCheckResult.textContent = "사용 가능한 아이디입니다.";
            usernameCheckResult.className = "text-success mt-2"; // 초록색
          }
        })
        .catch(error => {
          console.error("오류 발생:", error);
          usernameCheckResult.textContent = "오류가 발생했습니다.";
          usernameCheckResult.className = "text-danger mt-2"; // 빨간색
        });
    });
  </script>



  <script>
    // 폼 제출 시 새로운 사용자 추가 요청 보내기
    document.getElementById('user-form').addEventListener('submit', function (event) {
      event.preventDefault(); // 폼의 기본 제출 동작을 막음

      const name = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const address = document.getElementById('address').value.trim();
      const phoneNumber = document.getElementById('phoneNumber').value.trim();

      fetch('localhost:8080/members/new', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json' // JSON 형식으로 데이터 전송
        },
        body: JSON.stringify({
          name: name,
          password: password,
          address: address,
          phoneNumber: phoneNumber
        })
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
          alert('가입이 완료되었습니다!');
        })
        .catch(error => {
          console.error('Error:', error);
        });
    });
  </script>

</body>

</html>